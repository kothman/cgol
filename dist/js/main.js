// @todo Write unit tests
var Canvas = (function () {
    function Canvas(selector) {
        this.canvas = document.querySelector(selector);
        Canvas.lastResize = Date.now();
        this.ctx = this.canvas.getContext("2d");
        console.log("Initializing canvas");
        this.setCanvasDimensions();
        this.applyResizeListener();
    }
    /**
     * Apply resize listener on the window & update canvas dimensions on resize
     */
    Canvas.prototype.applyResizeListener = function () {
        window.addEventListener('resize', function (e) {
            if (Canvas.canResize()) {
                this.setCanvasDimensions();
            }
        }.bind(this));
    };
    Canvas.prototype.setCanvasDimensions = function () {
        var canvasDimensions = this.canvas.parentElement.getBoundingClientRect();
        this.setWidth(canvasDimensions.width);
        this.setHeight(canvasDimensions.height);
    };
    Canvas.prototype.setWidth = function (w) {
        this.width = w - (w % Cell.size);
        this.canvas.setAttribute("width", this.getWidth().toString());
        this.canvas.style.width = this.getWidth().toString();
    };
    Canvas.prototype.setHeight = function (h) {
        this.height = h - (h % Cell.size);
        this.canvas.setAttribute("height", this.getHeight().toString());
        this.canvas.style.height = this.getHeight().toString();
    };
    Canvas.prototype.getHeight = function () {
        return this.height;
    };
    Canvas.prototype.getWidth = function () {
        return this.width;
    };
    Canvas.prototype.getContext = function () {
        return this.ctx;
    };
    Canvas.prototype.getCanvas = function () {
        return this.canvas;
    };
    Canvas.canResize = function () {
        var now = Date.now();
        return now - 1000 >= Canvas.lastResize;
    };
    return Canvas;
}());
// @todo Write unit tests
var Cell = (function () {
    // @todo this should probably use a Point
    function Cell(x, y) {
        this.alive = false;
        this.x = x;
        this.y = y;
    }
    Cell.prototype.toggle = function () {
        this.alive = !this.alive;
    };
    Cell.prototype.kill = function () {
        this.alive = false;
    };
    Cell.prototype.regen = function () {
        this.alive = true;
    };
    Cell.prototype.isAlive = function () {
        return this.alive;
    };
    Cell.prototype.getX = function () {
        return Cell.getActualPosition(this.x);
    };
    Cell.prototype.getY = function () {
        return Cell.getActualPosition(this.y);
    };
    /**
     * Returns the actual position (x or y) based on the cell size
     */
    Cell.getActualPosition = function (i) {
        return (i * Cell.size);
    };
    Cell.getSize = function () {
        return Cell.size;
    };
    Cell.setSize = function (x) {
        Cell.size = 20 * x;
    };
    Cell.prototype.contains = function (x, y) {
        return (x >= this.x &&
            x <= Cell.getActualPosition(this.x) &&
            y >= this.y &&
            y <= Cell.getActualPosition(this.y));
    };
    /**
     * Take the mouse offset in the canvas element, mod Cell size, take that amount and trim it
     * from the mouse offset. Divide by cell size.
     */
    Cell.getCellCoordinates = function (p) {
        var x = Math.floor((p.x - (p.x % Cell.size)) / (Cell.size)), y = Math.floor((p.y - (p.y % Cell.size)) / (Cell.size));
        return new Point(x, y);
    };
    /**
     * Get Point of Cell
     */
    Cell.prototype.getPoint = function () {
        return new Point(this.x, this.y);
    };
    Cell.size = 200;
    return Cell;
}());
// @todo Write unit tests
var Life = (function () {
    function Life(c) {
        this.cells = null;
        this.oldCells = null;
        this.newCells = null;
        this.isPlaying = false;
        this.height = 400;
        this.width = 600;
        this.speed = 1;
        this.size = 1;
        this.canvas = c;
        this.canvas.setCanvasDimensions();
        this.assignToolbarElements();
        this.createCells();
        this.calculateNewCells();
        Cell.setSize(this.sizeRange.valueAsNumber);
        this.drawAllCells();
        this.addListeners();
    }
    Life.prototype.addListeners = function () {
        this.canvas.getCanvas().addEventListener('click', this.onClick.bind(this));
        window.addEventListener('resize', this.onResize.bind(this));
        this.playPauseButton.addEventListener('click', this.playPause.bind(this));
        this.stepButton.addEventListener('click', this.step.bind(this));
        this.resetButton.addEventListener('click', this.reset.bind(this));
        this.speedRange.addEventListener('change', this.onChangeSpeed.bind(this));
        this.sizeRange.addEventListener('change', this.onChangeSize.bind(this));
    };
    Life.prototype.assignToolbarElements = function () {
        this.playPauseButton = document.querySelector('.play-pause-button');
        this.stepButton = document.querySelector('.step-button');
        this.resetButton = document.querySelector('.reset-button');
        this.speedRange = document.querySelector('.speed-range');
        this.sizeRange = document.querySelector('.size-range');
    };
    Life.prototype.onClick = function (e) {
        var mouseClickPoint = new Point(e.offsetX, e.offsetY);
        var cellCoordinates = Cell.getCellCoordinates(mouseClickPoint);
        // toggle that cell
        var c = this.getCell(cellCoordinates);
        c.toggle();
        this.drawCell(c);
    };
    Life.prototype.onResize = function () {
        if (Canvas.canResize())
            this.drawAllCells();
    };
    Life.prototype.onChangeSpeed = function () {
        var wasPlaying = this.isPlaying;
        if (this.isPlaying)
            this.pause();
        this.speed = this.speedRange.valueAsNumber;
        if (wasPlaying)
            this.play();
    };
    Life.prototype.onChangeSize = function () {
        Cell.setSize(this.sizeRange.valueAsNumber);
        this.createCells();
        this.drawAllCells();
    };
    Life.prototype.createCells = function () {
        this.cells = [];
        for (var y = 0; y < this.height; y++) {
            this.cells.push([]);
            for (var x = 0; x < this.width; x++) {
                var c = new Cell(x, y);
                this.cells[y].push(c);
            }
        }
    };
    /**
     * Draw a given cell on the canvas
     */
    Life.prototype.drawCell = function (c) {
        if (this.cellOffScreen(c)) {
            c.kill();
            return;
        }
        var ctx = this.canvas.getContext();
        ctx.fillStyle = "black";
        ctx.strokeStyle = "black";
        ctx.fillRect(c.getX(), c.getY(), Cell.getSize(), Cell.getSize());
        if (!c.alive) {
            // Had some weird issues with using ctx.strokeRect,
            // seemed to create a larger rectangle than just ctx.fillRect
            ctx.clearRect(c.getX() + 1, c.getY() + 1, Cell.getSize() - 2, Cell.getSize() - 2);
        }
    };
    /**
     * Go through matrix and call this.drawCell on all cells
     */
    Life.prototype.drawAllCells = function () {
        for (var x = 0; x < this.width; x++) {
            for (var y = 0; y < this.height; y++) {
                this.drawCell(this.getCell(new Point(x, y)));
            }
        }
    };
    /**
     * Get a specific cell from the matrix, given a point
     */
    Life.prototype.getCell = function (p) {
        return this.cells[p.y][p.x];
    };
    /**
     * Check if the cell is off screen
     */
    Life.prototype.cellOffScreen = function (c) {
        return c.getX() + Cell.getSize() > this.canvas.getWidth() || c.getY() + Cell.getSize() > this.canvas.getHeight();
    };
    /**
     * Get matrix of all surrounding/adjacent cells
     */
    Life.prototype.getSurroundingCells = function (c) {
        var cells = [];
        // @todo Figure out a more elegant way to do this?
        if (c.x - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x - 1, c.y)));
        }
        if (c.x - 1 >= 0 && c.y - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x - 1, c.y - 1)));
        }
        if (c.x - 1 >= 0 && c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x - 1, c.y + 1)));
        }
        if (c.x + 1 < this.width) {
            cells.push(this.getCell(new Point(c.x + 1, c.y)));
        }
        if (c.y - 1 >= 0 && c.x + 1 < this.width) {
            cells.push(this.getCell(new Point(c.x + 1, c.y - 1)));
        }
        if (c.x + 1 < this.width && c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x + 1, c.y + 1)));
        }
        if (c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x, c.y + 1)));
        }
        if (c.y - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x, c.y - 1)));
        }
        return cells;
    };
    /**
     * Check if the cell should die off. Rule applied directly to cell.
     */
    Life.prototype.shouldCellDieRule = function (c) {
        var cells = this.getSurroundingCells(c);
        var aliveCells = cells.filter(function (cell, index, array) {
            return cell.isAlive();
        });
        if (c.isAlive() && (aliveCells.length > 3 || aliveCells.length < 2))
            c.kill();
    };
    /**
     * Check if the cell should be brought back to life. Rule applied directly to cell.
     */
    Life.prototype.shouldCellRegenerateRule = function (c) {
        var cells = this.getSurroundingCells(c);
        var aliveCells = cells.filter(function (cell, index, array) {
            return cell.isAlive();
        });
        if (!c.isAlive() && (aliveCells.length == 3)) {
            c.regen();
        }
    };
    Life.prototype.applyRules = function (c) {
        var newCell = Life.cloneCell(c);
        if (c.isAlive()) {
            this.shouldCellDieRule(newCell);
        }
        else {
            this.shouldCellRegenerateRule(newCell);
        }
        return newCell;
    };
    /**
     * Make a clone of a cell
     */
    Life.cloneCell = function (c) {
        var newCell = new Cell(c.x, c.y);
        c.isAlive() ? newCell.regen() : newCell.kill();
        return newCell;
    };
    /**
     * Calculate matrix of cells for the next step, based on applied rules
     */
    Life.prototype.calculateNewCells = function () {
        this.newCells = [];
        for (var y = 0; y < this.height; y++) {
            this.newCells.push([]);
            for (var x = 0; x < this.width; x++) {
                var c = this.getCell(new Point(x, y));
                c = this.applyRules(c);
                this.newCells[y].push(c);
            }
        }
    };
    /**
     * Step forward one generation
     */
    Life.prototype.step = function () {
        this.calculateNewCells();
        this.oldCells = this.cells;
        this.cells = this.newCells;
        this.drawAllCells();
    };
    /**
     * Being automatically stepping forward until told to stop, at the saved rate
     */
    Life.prototype.play = function () {
        this.playPauseButton.classList.remove('paused');
        this.playPauseButton.classList.add('playing');
        this.playPauseButton.querySelector('.text').innerHTML = 'Pause';
        this.step();
        this.intervalReference = setInterval(function () {
            this.step();
        }.bind(this), 1000 / this.speed);
    };
    /**
     * Stop stepping forward
     */
    Life.prototype.pause = function () {
        this.playPauseButton.classList.remove('playing');
        this.playPauseButton.classList.add('paused');
        this.playPauseButton.querySelector('.text').innerHTML = 'Play';
        clearInterval(this.intervalReference);
    };
    Life.prototype.reset = function () {
        if (this.isPlaying) {
            this.pause();
        }
        this.clear();
    };
    Life.prototype.clear = function () {
        for (var y = 0; y < this.height; y++) {
            for (var x = 0; x < this.width; x++) {
                var c = this.getCell(new Point(x, y));
                c.kill();
            }
        }
        this.drawAllCells();
    };
    Life.prototype.playPause = function () {
        this.isPlaying ? this.pause() : this.play();
        this.isPlaying = !this.isPlaying;
    };
    return Life;
}());
// @todo Write unit tests
var Point = (function () {
    function Point(x, y) {
        this.x = x;
        this.y = y;
    }
    Point.prototype.log = function () {
        console.log('(' + this.x + ', ' + this.y + ')');
    };
    return Point;
}());
var debug = true;
var C = new Canvas("#the-canvas");
var L = new Life(C);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC90cy9saWIvQ2FudmFzLnRzIiwiYXBwL3RzL2xpYi9DZWxsLnRzIiwiYXBwL3RzL2xpYi9MaWZlLnRzIiwiYXBwL3RzL2xpYi9Qb2ludC50cyIsImFwcC90cy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHlCQUF5QjtBQUN6QjtJQVFJLGdCQUFZLFFBQWdCO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQXVCLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkUsTUFBTSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV4QyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFbkMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsb0NBQW1CLEdBQW5CO1FBQ0ksTUFBTSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxVQUFTLENBQUM7WUFDeEMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDckIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDL0IsQ0FBQztRQUNMLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQsb0NBQW1CLEdBQW5CO1FBQ0ksSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3pFLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FB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QUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUN4QyxDQUFDO1FBQ04sQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLEtBQUssQ0FBQyxJQUFJLENBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQzVDLENBQUM7UUFDTixDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLEtBQUssQ0FBQyxJQUFJLENBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQzVDLENBQUM7UUFDTixDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDdkIsS0FBSyxDQUFDLElBQUksQ0FDTixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUN4QyxDQUFDO1FBQ04sQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMs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O1FBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUwsWUFBQztBQUFELENBZEEsQUFjQyxJQUFBO0FDZkQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO0FBRWpCLElBQUksQ0FBQyxHQUFXLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzFDLElBQUksQ0FBQyxHQUFTLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdG9kbyBXcml0ZSB1bml0IHRlc3RzXG5jbGFzcyBDYW52YXMge1xuICAgIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgaGVpZ2h0OiBudW1iZXI7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBzdGF0aWMgbGFzdFJlc2l6ZTogbnVtYmVyO1xuXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICBjb25zdHJ1Y3RvcihzZWxlY3Rvcjogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgQ2FudmFzLmxhc3RSZXNpemUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyBjYW52YXNcIik7XG5cbiAgICAgICAgdGhpcy5zZXRDYW52YXNEaW1lbnNpb25zKCk7XG4gICAgICAgIHRoaXMuYXBwbHlSZXNpemVMaXN0ZW5lcigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IHJlc2l6ZSBsaXN0ZW5lciBvbiB0aGUgd2luZG93ICYgdXBkYXRlIGNhbnZhcyBkaW1lbnNpb25zIG9uIHJlc2l6ZVxuICAgICAqL1xuICAgIGFwcGx5UmVzaXplTGlzdGVuZXIoKSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoQ2FudmFzLmNhblJlc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDYW52YXNEaW1lbnNpb25zKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgc2V0Q2FudmFzRGltZW5zaW9ucygpIHtcbiAgICAgICAgbGV0IGNhbnZhc0RpbWVuc2lvbnMgPSB0aGlzLmNhbnZhcy5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB0aGlzLnNldFdpZHRoKGNhbnZhc0RpbWVuc2lvbnMud2lkdGgpO1xuICAgICAgICB0aGlzLnNldEhlaWdodChjYW52YXNEaW1lbnNpb25zLmhlaWdodCk7XG4gICAgfVxuXG4gICAgc2V0V2lkdGgodzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMud2lkdGggPSB3IC0gKHcgJSBDZWxsLnNpemUpO1xuICAgICAgICB0aGlzLmNhbnZhcy5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCB0aGlzLmdldFdpZHRoKCkudG9TdHJpbmcoKSk7XG4gICAgICAgIHRoaXMuY2FudmFzLnN0eWxlLndpZHRoID0gdGhpcy5nZXRXaWR0aCgpLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgc2V0SGVpZ2h0KGg6IG51bWJlcikge1xuICAgICAgICB0aGlzLmhlaWdodCA9IGggLSAoaCAlIENlbGwuc2l6ZSk7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCB0aGlzLmdldEhlaWdodCgpLnRvU3RyaW5nKCkpO1xuICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS5oZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgZ2V0SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmhlaWdodDtcbiAgICB9XG4gICAgZ2V0V2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7XG4gICAgfVxuXG4gICAgZ2V0Q29udGV4dCgpOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQge1xuICAgICAgICByZXR1cm4gdGhpcy5jdHg7XG4gICAgfVxuXG4gICAgZ2V0Q2FudmFzKCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzO1xuICAgIH1cblxuICAgIHN0YXRpYyBjYW5SZXNpemUoKTogYm9vbGVhbiB7XG4gICAgICAgIGxldCBub3c6IG51bWJlciA9IERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiBub3cgLSAxMDAwID49IENhbnZhcy5sYXN0UmVzaXplO1xuICAgIH1cblxufSIsIi8vIEB0b2RvIFdyaXRlIHVuaXQgdGVzdHNcbmNsYXNzIENlbGwge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG5cbiAgICBhbGl2ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgc3RhdGljIHNpemU6IG51bWJlciA9IDIwMDtcblxuICAgIC8vIEB0b2RvIHRoaXMgc2hvdWxkIHByb2JhYmx5IHVzZSBhIFBvaW50XG4gICAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcblxuICAgIH1cblxuICAgIHRvZ2dsZSgpIHtcbiAgICAgICAgdGhpcy5hbGl2ZSA9ICF0aGlzLmFsaXZlO1xuICAgIH1cblxuICAgIGtpbGwoKSB7XG4gICAgICAgIHRoaXMuYWxpdmUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZWdlbigpIHtcbiAgICAgICAgdGhpcy5hbGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgaXNBbGl2ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWxpdmU7XG4gICAgfVxuXG4gICAgZ2V0WCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gQ2VsbC5nZXRBY3R1YWxQb3NpdGlvbih0aGlzLngpO1xuICAgIH1cblxuICAgIGdldFkoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIENlbGwuZ2V0QWN0dWFsUG9zaXRpb24odGhpcy55KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBhY3R1YWwgcG9zaXRpb24gKHggb3IgeSkgYmFzZWQgb24gdGhlIGNlbGwgc2l6ZVxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRBY3R1YWxQb3NpdGlvbihpOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gKGkgKiBDZWxsLnNpemUpO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXRTaXplKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBDZWxsLnNpemU7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldFNpemUoeDogbnVtYmVyKSB7XG4gICAgICAgIENlbGwuc2l6ZSA9IDIwICogeDtcbiAgICB9XG5cbiAgICBjb250YWlucyh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgeCA+PSB0aGlzLnggJiZcbiAgICAgICAgICAgIHggPD0gQ2VsbC5nZXRBY3R1YWxQb3NpdGlvbih0aGlzLngpICYmXG4gICAgICAgICAgICB5ID49IHRoaXMueSAmJlxuICAgICAgICAgICAgeSA8PSBDZWxsLmdldEFjdHVhbFBvc2l0aW9uKHRoaXMueSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlIHRoZSBtb3VzZSBvZmZzZXQgaW4gdGhlIGNhbnZhcyBlbGVtZW50LCBtb2QgQ2VsbCBzaXplLCB0YWtlIHRoYXQgYW1vdW50IGFuZCB0cmltIGl0XG4gICAgICogZnJvbSB0aGUgbW91c2Ugb2Zmc2V0LiBEaXZpZGUgYnkgY2VsbCBzaXplLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRDZWxsQ29vcmRpbmF0ZXMocDogUG9pbnQpOiBQb2ludCB7XG4gICAgICAgIGxldCB4ID0gTWF0aC5mbG9vcigocC54IC0gKHAueCAlIENlbGwuc2l6ZSkpIC8gKENlbGwuc2l6ZSkpLFxuICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoKHAueSAtIChwLnkgJSBDZWxsLnNpemUpKSAvIChDZWxsLnNpemUpKTtcblxuICAgICAgICByZXR1cm4gbmV3IFBvaW50KHgsIHkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBQb2ludCBvZiBDZWxsXG4gICAgICovXG4gICAgZ2V0UG9pbnQoKTogUG9pbnQge1xuICAgICAgICByZXR1cm4gbmV3IFBvaW50KHRoaXMueCwgdGhpcy55KTtcbiAgICB9XG5cbn0iLCIvLyBAdG9kbyBXcml0ZSB1bml0IHRlc3RzXG5jbGFzcyBMaWZlIHtcblxuICAgIGNlbGxzOiBDZWxsW11bXSA9IG51bGw7XG4gICAgb2xkQ2VsbHM6IENlbGxbXVtdID0gbnVsbDtcbiAgICBuZXdDZWxsczogQ2VsbFtdW10gPSBudWxsO1xuXG4gICAgY2FudmFzOiBDYW52YXM7XG5cbiAgICBwbGF5UGF1c2VCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHN0ZXBCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHJlc2V0QnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICBzcGVlZFJhbmdlOiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHNpemVSYW5nZTogSFRNTElucHV0RWxlbWVudDtcblxuICAgIGlzUGxheWluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgaGVpZ2h0OiBudW1iZXIgPSA0MDA7XG4gICAgd2lkdGg6IG51bWJlciA9IDYwMDtcblxuICAgIHNwZWVkOiBudW1iZXIgPSAxO1xuICAgIHNpemU6IG51bWJlciA9IDE7XG5cbiAgICBwcml2YXRlIGludGVydmFsUmVmZXJlbmNlOiBudW1iZXI7XG5cblxuICAgIGNvbnN0cnVjdG9yKGM6IENhbnZhcykge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGM7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldENhbnZhc0RpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5hc3NpZ25Ub29sYmFyRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVDZWxscygpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZU5ld0NlbGxzKCk7XG4gICAgICAgIENlbGwuc2V0U2l6ZSh0aGlzLnNpemVSYW5nZS52YWx1ZUFzTnVtYmVyKTtcbiAgICAgICAgdGhpcy5kcmF3QWxsQ2VsbHMoKTtcblxuICAgICAgICB0aGlzLmFkZExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGFkZExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5jYW52YXMuZ2V0Q2FudmFzKCkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucGxheVBhdXNlLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnN0ZXBCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnN0ZXAuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucmVzZXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnJlc2V0LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnNwZWVkUmFuZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZVNwZWVkLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnNpemVSYW5nZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLm9uQ2hhbmdlU2l6ZS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBhc3NpZ25Ub29sYmFyRWxlbWVudHMoKSB7XG4gICAgICAgIHRoaXMucGxheVBhdXNlQnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheS1wYXVzZS1idXR0b24nKTtcbiAgICAgICAgdGhpcy5zdGVwQnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RlcC1idXR0b24nKTtcbiAgICAgICAgdGhpcy5yZXNldEJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc2V0LWJ1dHRvbicpO1xuICAgICAgICB0aGlzLnNwZWVkUmFuZ2UgPSA8SFRNTElucHV0RWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNwZWVkLXJhbmdlJyk7XG4gICAgICAgIHRoaXMuc2l6ZVJhbmdlID0gPEhUTUxJbnB1dEVsZW1lbnQ+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaXplLXJhbmdlJyk7XG4gICAgfVxuXG4gICAgb25DbGljayhlOiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGxldCBtb3VzZUNsaWNrUG9pbnQgPSBuZXcgUG9pbnQoZS5vZmZzZXRYLCBlLm9mZnNldFkpO1xuICAgICAgICBsZXQgY2VsbENvb3JkaW5hdGVzID0gQ2VsbC5nZXRDZWxsQ29vcmRpbmF0ZXMobW91c2VDbGlja1BvaW50KTtcblxuICAgICAgICAvLyB0b2dnbGUgdGhhdCBjZWxsXG4gICAgICAgIGxldCBjID0gdGhpcy5nZXRDZWxsKGNlbGxDb29yZGluYXRlcyk7XG4gICAgICAgIGMudG9nZ2xlKCk7XG4gICAgICAgIHRoaXMuZHJhd0NlbGwoYyk7XG4gICAgfVxuXG4gICAgb25SZXNpemUoKSB7XG4gICAgICAgIGlmIChDYW52YXMuY2FuUmVzaXplKCkpXG4gICAgICAgICAgICB0aGlzLmRyYXdBbGxDZWxscygpO1xuICAgIH1cblxuICAgIG9uQ2hhbmdlU3BlZWQoKSB7XG4gICAgICAgIGxldCB3YXNQbGF5aW5nID0gdGhpcy5pc1BsYXlpbmc7XG4gICAgICAgIGlmICh0aGlzLmlzUGxheWluZylcbiAgICAgICAgICAgIHRoaXMucGF1c2UoKTtcbiAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMuc3BlZWRSYW5nZS52YWx1ZUFzTnVtYmVyO1xuICAgICAgICBpZiAod2FzUGxheWluZylcbiAgICAgICAgICAgIHRoaXMucGxheSgpO1xuICAgIH1cblxuICAgIG9uQ2hhbmdlU2l6ZSgpIHtcbiAgICAgICAgQ2VsbC5zZXRTaXplKHRoaXMuc2l6ZVJhbmdlLnZhbHVlQXNOdW1iZXIpO1xuICAgICAgICB0aGlzLmNyZWF0ZUNlbGxzKCk7XG4gICAgICAgIHRoaXMuZHJhd0FsbENlbGxzKCk7XG4gICAgfVxuXG4gICAgY3JlYXRlQ2VsbHMoKSB7XG4gICAgICAgIHRoaXMuY2VsbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICB0aGlzLmNlbGxzLnB1c2goW10pO1xuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLndpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICBsZXQgYzogQ2VsbCA9IG5ldyBDZWxsKHgsIHkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2VsbHNbeV0ucHVzaChjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERyYXcgYSBnaXZlbiBjZWxsIG9uIHRoZSBjYW52YXNcbiAgICAgKi9cbiAgICBkcmF3Q2VsbChjOiBDZWxsKSB7XG4gICAgICAgIGlmICh0aGlzLmNlbGxPZmZTY3JlZW4oYykpIHtcbiAgICAgICAgICAgIGMua2lsbCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAgICAgY3R4LmZpbGxSZWN0KGMuZ2V0WCgpLCBjLmdldFkoKSwgQ2VsbC5nZXRTaXplKCksIENlbGwuZ2V0U2l6ZSgpKTtcbiAgICAgICAgaWYgKCFjLmFsaXZlKSB7XG4gICAgICAgICAgICAvLyBIYWQgc29tZSB3ZWlyZCBpc3N1ZXMgd2l0aCB1c2luZyBjdHguc3Ryb2tlUmVjdCxcbiAgICAgICAgICAgIC8vIHNlZW1lZCB0byBjcmVhdGUgYSBsYXJnZXIgcmVjdGFuZ2xlIHRoYW4ganVzdCBjdHguZmlsbFJlY3RcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoYy5nZXRYKCkgKyAxLCBjLmdldFkoKSArIDEsIENlbGwuZ2V0U2l6ZSgpIC0gMiwgQ2VsbC5nZXRTaXplKCkgLSAyKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR28gdGhyb3VnaCBtYXRyaXggYW5kIGNhbGwgdGhpcy5kcmF3Q2VsbCBvbiBhbGwgY2VsbHNcbiAgICAgKi9cbiAgICBkcmF3QWxsQ2VsbHMoKSB7XG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdDZWxsKHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoeCwgeSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIHNwZWNpZmljIGNlbGwgZnJvbSB0aGUgbWF0cml4LCBnaXZlbiBhIHBvaW50XG4gICAgICovXG4gICAgZ2V0Q2VsbChwOiBQb2ludCk6IENlbGwge1xuICAgICAgICByZXR1cm4gdGhpcy5jZWxsc1twLnldW3AueF07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGNlbGwgaXMgb2ZmIHNjcmVlblxuICAgICAqL1xuICAgIGNlbGxPZmZTY3JlZW4oYyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYy5nZXRYKCkgKyBDZWxsLmdldFNpemUoKSA+IHRoaXMuY2FudmFzLmdldFdpZHRoKCkgfHwgYy5nZXRZKCkgKyBDZWxsLmdldFNpemUoKSA+IHRoaXMuY2FudmFzLmdldEhlaWdodCgpO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IG1hdHJpeCBvZiBhbGwgc3Vycm91bmRpbmcvYWRqYWNlbnQgY2VsbHNcbiAgICAgKi9cbiAgICBnZXRTdXJyb3VuZGluZ0NlbGxzKGM6IENlbGwpOiBDZWxsW10ge1xuICAgICAgICBsZXQgY2VsbHMgPSBbXTtcblxuICAgICAgICAvLyBAdG9kbyBGaWd1cmUgb3V0IGEgbW9yZSBlbGVnYW50IHdheSB0byBkbyB0aGlzP1xuICAgICAgICBpZiAoYy54IC0gMSA+PSAwKSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54IC0gMSwgYy55KSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueCAtIDEgPj0gMCAmJiBjLnkgLSAxID49IDApIHtcbiAgICAgICAgICAgIGNlbGxzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDZWxsKG5ldyBQb2ludChjLnggLSAxLCBjLnkgLSAxKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueCAtIDEgPj0gMCAmJiBjLnkgKyAxIDwgdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgICAgIGNlbGxzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDZWxsKG5ldyBQb2ludChjLnggLSAxLCBjLnkgKyAxKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueCArIDEgPCB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54ICsgMSwgYy55KSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueSAtIDEgPj0gMCAmJiBjLnggKyAxIDwgdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLmdldENlbGwobmV3IFBvaW50KGMueCArIDEsIGMueSAtIDEpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYy54ICsgMSA8IHRoaXMud2lkdGggJiYgYy55ICsgMSA8IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54ICsgMSwgYy55ICsgMSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjLnkgKyAxIDwgdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgICAgIGNlbGxzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDZWxsKG5ldyBQb2ludChjLngsIGMueSArIDEpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYy55IC0gMSA+PSAwKSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54LCBjLnkgLSAxKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2VsbHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGNlbGwgc2hvdWxkIGRpZSBvZmYuIFJ1bGUgYXBwbGllZCBkaXJlY3RseSB0byBjZWxsLlxuICAgICAqL1xuICAgIHNob3VsZENlbGxEaWVSdWxlKGM6IENlbGwpIHtcbiAgICAgICAgbGV0IGNlbGxzID0gdGhpcy5nZXRTdXJyb3VuZGluZ0NlbGxzKGMpO1xuICAgICAgICBsZXQgYWxpdmVDZWxscyA9IGNlbGxzLmZpbHRlcihmdW5jdGlvbiAoY2VsbCwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5pc0FsaXZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoYy5pc0FsaXZlKCkgJiYgKGFsaXZlQ2VsbHMubGVuZ3RoID4gMyB8fCBhbGl2ZUNlbGxzLmxlbmd0aCA8IDIpKVxuICAgICAgICAgICAgYy5raWxsKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgdGhlIGNlbGwgc2hvdWxkIGJlIGJyb3VnaHQgYmFjayB0byBsaWZlLiBSdWxlIGFwcGxpZWQgZGlyZWN0bHkgdG8gY2VsbC5cbiAgICAgKi9cbiAgICBzaG91bGRDZWxsUmVnZW5lcmF0ZVJ1bGUoYzogQ2VsbCkge1xuICAgICAgICBsZXQgY2VsbHMgPSB0aGlzLmdldFN1cnJvdW5kaW5nQ2VsbHMoYyk7XG4gICAgICAgIGxldCBhbGl2ZUNlbGxzID0gY2VsbHMuZmlsdGVyKGZ1bmN0aW9uIChjZWxsLCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLmlzQWxpdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghYy5pc0FsaXZlKCkgJiYgKGFsaXZlQ2VsbHMubGVuZ3RoID09IDMpKSB7XG4gICAgICAgICAgICBjLnJlZ2VuKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhcHBseVJ1bGVzKGM6IENlbGwpOiBDZWxsIHtcbiAgICAgICAgbGV0IG5ld0NlbGwgPSBMaWZlLmNsb25lQ2VsbChjKTtcbiAgICAgICAgaWYgKGMuaXNBbGl2ZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnNob3VsZENlbGxEaWVSdWxlKG5ld0NlbGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaG91bGRDZWxsUmVnZW5lcmF0ZVJ1bGUobmV3Q2VsbCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3Q2VsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIGEgY2xvbmUgb2YgYSBjZWxsXG4gICAgICovXG4gICAgc3RhdGljIGNsb25lQ2VsbChjOiBDZWxsKTogQ2VsbCB7XG4gICAgICAgIGxldCBuZXdDZWxsID0gbmV3IENlbGwoYy54LCBjLnkpO1xuICAgICAgICBjLmlzQWxpdmUoKSA/IG5ld0NlbGwucmVnZW4oKSA6IG5ld0NlbGwua2lsbCgpO1xuICAgICAgICByZXR1cm4gbmV3Q2VsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgbWF0cml4IG9mIGNlbGxzIGZvciB0aGUgbmV4dCBzdGVwLCBiYXNlZCBvbiBhcHBsaWVkIHJ1bGVzXG4gICAgICovXG4gICAgY2FsY3VsYXRlTmV3Q2VsbHMoKSB7XG4gICAgICAgIHRoaXMubmV3Q2VsbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICB0aGlzLm5ld0NlbGxzLnB1c2goW10pO1xuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLndpZHRoOyB4KyspIHtcbiAgICAgICAgICAgICAgICBsZXQgYyA9IHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoeCwgeSkpO1xuICAgICAgICAgICAgICAgIGMgPSB0aGlzLmFwcGx5UnVsZXMoYyk7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdDZWxsc1t5XS5wdXNoKGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RlcCBmb3J3YXJkIG9uZSBnZW5lcmF0aW9uXG4gICAgICovXG4gICAgc3RlcCgpIHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVOZXdDZWxscygpO1xuICAgICAgICB0aGlzLm9sZENlbGxzID0gdGhpcy5jZWxscztcbiAgICAgICAgdGhpcy5jZWxscyA9IHRoaXMubmV3Q2VsbHM7XG4gICAgICAgIHRoaXMuZHJhd0FsbENlbGxzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQmVpbmcgYXV0b21hdGljYWxseSBzdGVwcGluZyBmb3J3YXJkIHVudGlsIHRvbGQgdG8gc3RvcCwgYXQgdGhlIHNhdmVkIHJhdGVcbiAgICAgKi9cbiAgICBwbGF5KCkge1xuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdwYXVzZWQnKVxuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdwbGF5aW5nJyk7XG4gICAgICAgIHRoaXMucGxheVBhdXNlQnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJy50ZXh0JykuaW5uZXJIVE1MID0gJ1BhdXNlJztcbiAgICAgICAgdGhpcy5zdGVwKCk7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWxSZWZlcmVuY2UgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnN0ZXAoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCAxMDAwIC8gdGhpcy5zcGVlZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RvcCBzdGVwcGluZyBmb3J3YXJkXG4gICAgICovXG4gICAgcGF1c2UoKSB7XG5cbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncGxheWluZycpO1xuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdwYXVzZWQnKTtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24ucXVlcnlTZWxlY3RvcignLnRleHQnKS5pbm5lckhUTUwgPSAnUGxheSc7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbFJlZmVyZW5jZSk7XG4gICAgfVxuXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUGxheWluZykge1xuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcblxuICAgIH1cblxuICAgIGNsZWFyKCkge1xuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGMgPSB0aGlzLmdldENlbGwobmV3IFBvaW50KHgsIHkpKTtcbiAgICAgICAgICAgICAgICBjLmtpbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRyYXdBbGxDZWxscygpO1xuICAgIH1cblxuICAgIHBsYXlQYXVzZSgpIHtcbiAgICAgICAgdGhpcy5pc1BsYXlpbmcgPyB0aGlzLnBhdXNlKCkgOiB0aGlzLnBsYXkoKTtcbiAgICAgICAgdGhpcy5pc1BsYXlpbmcgPSAhdGhpcy5pc1BsYXlpbmc7XG4gICAgfVxuXG59IiwiLy8gQHRvZG8gV3JpdGUgdW5pdCB0ZXN0c1xuY2xhc3MgUG9pbnQge1xuXG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgfVxuXG4gICAgbG9nKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnKCcgKyB0aGlzLnggKyAnLCAnICsgdGhpcy55ICsgJyknKTtcbiAgICB9XG5cbn0iLCJ2YXIgZGVidWcgPSB0cnVlO1xuXG5sZXQgQzogQ2FudmFzID0gbmV3IENhbnZhcyhcIiN0aGUtY2FudmFzXCIpO1xubGV0IEw6IExpZmUgPSBuZXcgTGlmZShDKTsiXX0=
