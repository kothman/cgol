// @todo Write unit tests
var Canvas = (function () {
    function Canvas(selector) {
        this.canvas = document.querySelector(selector);
        Canvas.lastResize = Date.now();
        this.ctx = this.canvas.getContext("2d");
        console.log("Initializing canvas");
        this.setCanvasDimensions();
        this.applyResizeListener();
    }
    /**
     * Apply resize listener on the window & update canvas dimensions on resize
     */
    Canvas.prototype.applyResizeListener = function () {
        window.addEventListener('resize', function (e) {
            if (Canvas.canResize()) {
                this.setCanvasDimensions();
            }
        }.bind(this));
    };
    Canvas.prototype.setCanvasDimensions = function () {
        var canvasDimensions = this.canvas.parentElement.getBoundingClientRect();
        this.setWidth(canvasDimensions.width);
        this.setHeight(canvasDimensions.height);
    };
    Canvas.prototype.setWidth = function (w) {
        this.width = w - (w % Cell.size);
        this.canvas.setAttribute("width", this.getWidth().toString());
        this.canvas.style.width = this.getWidth().toString();
    };
    Canvas.prototype.setHeight = function (h) {
        this.height = h - (h % Cell.size);
        this.canvas.setAttribute("height", this.getHeight().toString());
        this.canvas.style.height = this.getHeight().toString();
    };
    Canvas.prototype.getHeight = function () {
        return this.height;
    };
    Canvas.prototype.getWidth = function () {
        return this.width;
    };
    Canvas.prototype.getContext = function () {
        return this.ctx;
    };
    Canvas.prototype.getCanvas = function () {
        return this.canvas;
    };
    Canvas.canResize = function () {
        var now = Date.now();
        return now - 1000 >= Canvas.lastResize;
    };
    return Canvas;
}());
// @todo Write unit tests
var Cell = (function () {
    // @todo this should probably use a Point
    function Cell(x, y) {
        this.alive = false;
        this.x = x;
        this.y = y;
    }
    Cell.prototype.toggle = function () {
        this.alive = !this.alive;
    };
    Cell.prototype.kill = function () {
        this.alive = false;
    };
    Cell.prototype.regen = function () {
        this.alive = true;
    };
    Cell.prototype.isAlive = function () {
        return this.alive;
    };
    Cell.prototype.getX = function () {
        return Cell.getActualPosition(this.x);
    };
    Cell.prototype.getY = function () {
        return Cell.getActualPosition(this.y);
    };
    /**
     * Returns the actual position (x or y) based on the cell size
     */
    Cell.getActualPosition = function (i) {
        return (i * Cell.size);
    };
    Cell.getSize = function () {
        return Cell.size;
    };
    Cell.setSize = function (x) {
        Cell.size = x;
    };
    Cell.prototype.contains = function (x, y) {
        return (x >= this.x &&
            x <= Cell.getActualPosition(this.x) &&
            y >= this.y &&
            y <= Cell.getActualPosition(this.y));
    };
    /**
     * Take the mouse offset in the canvas element, mod Cell size, take that amount and trim it
     * from the mouse offset. Divide by cell size.
     */
    Cell.getCellCoordinates = function (p) {
        var x = Math.floor((p.x - (p.x % Cell.size)) / (Cell.size)), y = Math.floor((p.y - (p.y % Cell.size)) / (Cell.size));
        return new Point(x, y);
    };
    /**
     * Get Point of Cell
     */
    Cell.prototype.getPoint = function () {
        return new Point(this.x, this.y);
    };
    Cell.size = 200;
    return Cell;
}());
// @todo Write unit tests
var Life = (function () {
    function Life(c) {
        this.cells = null;
        this.oldCells = null;
        this.newCells = null;
        this.isPlaying = false;
        this.height = 400;
        this.width = 600;
        this.speed = 1;
        this.size = 1;
        this.canvas = c;
        this.canvas.setCanvasDimensions();
        this.assignToolbarElements();
        this.createCells();
        this.calculateNewCells();
        this.drawAllCells();
        this.addListeners();
    }
    Life.prototype.addListeners = function () {
        this.canvas.getCanvas().addEventListener('click', this.onClick.bind(this));
        window.addEventListener('resize', this.onResize.bind(this));
        this.playPauseButton.addEventListener('click', this.playPause.bind(this));
        this.stepButton.addEventListener('click', this.step.bind(this));
        this.resetButton.addEventListener('click', this.reset.bind(this));
        this.speedRange.addEventListener('change', this.onChangeSpeed.bind(this));
        this.sizeRange.addEventListener('change', this.onChangeSize.bind(this));
    };
    Life.prototype.assignToolbarElements = function () {
        this.playPauseButton = document.querySelector('.play-pause-button');
        this.stepButton = document.querySelector('.step-button');
        this.resetButton = document.querySelector('.reset-button');
        this.speedRange = document.querySelector('.speed-range');
        this.sizeRange = document.querySelector('.size-range');
    };
    Life.prototype.onClick = function (e) {
        var mouseClickPoint = new Point(e.offsetX, e.offsetY);
        var cellCoordinates = Cell.getCellCoordinates(mouseClickPoint);
        // toggle that cell
        var c = this.getCell(cellCoordinates);
        c.toggle();
        this.drawCell(c);
    };
    Life.prototype.onResize = function () {
        if (Canvas.canResize())
            this.drawAllCells();
    };
    Life.prototype.onChangeSpeed = function () {
        var wasPlaying = this.isPlaying;
        if (this.isPlaying)
            this.pause();
        this.speed = this.speedRange.valueAsNumber;
        if (wasPlaying)
            this.play();
    };
    Life.prototype.onChangeSize = function () {
        Cell.setSize(100 / this.sizeRange.valueAsNumber);
        this.createCells();
        this.drawAllCells();
    };
    Life.prototype.createCells = function () {
        this.cells = [];
        for (var y = 0; y < this.height; y++) {
            this.cells.push([]);
            for (var x = 0; x < this.width; x++) {
                var c = new Cell(x, y);
                this.cells[y].push(c);
            }
        }
    };
    /**
     * Draw a given cell on the canvas
     */
    Life.prototype.drawCell = function (c) {
        if (this.cellOffScreen(c)) {
            c.kill();
            return;
        }
        var ctx = this.canvas.getContext();
        ctx.fillStyle = "black";
        ctx.strokeStyle = "black";
        ctx.fillRect(c.getX(), c.getY(), Cell.getSize(), Cell.getSize());
        if (!c.alive) {
            // Had some weird issues with using ctx.strokeRect,
            // seemed to create a larger rectangle than just ctx.fillRect
            ctx.clearRect(c.getX() + 1, c.getY() + 1, Cell.getSize() - 2, Cell.getSize() - 2);
        }
    };
    /**
     * Go through matrix and call this.drawCell on all cells
     */
    Life.prototype.drawAllCells = function () {
        for (var x = 0; x < this.width; x++) {
            for (var y = 0; y < this.height; y++) {
                this.drawCell(this.getCell(new Point(x, y)));
            }
        }
    };
    /**
     * Get a specific cell from the matrix, given a point
     */
    Life.prototype.getCell = function (p) {
        return this.cells[p.y][p.x];
    };
    /**
     * Check if the cell is off screen
     */
    Life.prototype.cellOffScreen = function (c) {
        return c.getX() + Cell.getSize() > this.canvas.getWidth() || c.getY() + Cell.getSize() > this.canvas.getHeight();
    };
    /**
     * Get matrix of all surrounding/adjacent cells
     */
    Life.prototype.getSurroundingCells = function (c) {
        var cells = [];
        // @todo Figure out a more elegant way to do this?
        if (c.x - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x - 1, c.y)));
        }
        if (c.x - 1 >= 0 && c.y - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x - 1, c.y - 1)));
        }
        if (c.x - 1 >= 0 && c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x - 1, c.y + 1)));
        }
        if (c.x + 1 < this.width) {
            cells.push(this.getCell(new Point(c.x + 1, c.y)));
        }
        if (c.y - 1 >= 0 && c.x + 1 < this.width) {
            cells.push(this.getCell(new Point(c.x + 1, c.y - 1)));
        }
        if (c.x + 1 < this.width && c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x + 1, c.y + 1)));
        }
        if (c.y + 1 < this.height) {
            cells.push(this.getCell(new Point(c.x, c.y + 1)));
        }
        if (c.y - 1 >= 0) {
            cells.push(this.getCell(new Point(c.x, c.y - 1)));
        }
        return cells;
    };
    /**
     * Check if the cell should die off. Rule applied directly to cell.
     */
    Life.prototype.shouldCellDieRule = function (c) {
        var cells = this.getSurroundingCells(c);
        var aliveCells = cells.filter(function (cell, index, array) {
            return cell.isAlive();
        });
        if (c.isAlive() && (aliveCells.length > 3 || aliveCells.length < 2))
            c.kill();
    };
    /**
     * Check if the cell should be brought back to life. Rule applied directly to cell.
     */
    Life.prototype.shouldCellRegenerateRule = function (c) {
        var cells = this.getSurroundingCells(c);
        var aliveCells = cells.filter(function (cell, index, array) {
            return cell.isAlive();
        });
        if (!c.isAlive() && (aliveCells.length == 3)) {
            c.regen();
        }
    };
    Life.prototype.applyRules = function (c) {
        var newCell = Life.cloneCell(c);
        if (c.isAlive()) {
            this.shouldCellDieRule(newCell);
        }
        else {
            this.shouldCellRegenerateRule(newCell);
        }
        return newCell;
    };
    /**
     * Make a clone of a cell
     */
    Life.cloneCell = function (c) {
        var newCell = new Cell(c.x, c.y);
        c.isAlive() ? newCell.regen() : newCell.kill();
        return newCell;
    };
    /**
     * Calculate matrix of cells for the next step, based on applied rules
     */
    Life.prototype.calculateNewCells = function () {
        this.newCells = [];
        for (var y = 0; y < this.height; y++) {
            this.newCells.push([]);
            for (var x = 0; x < this.width; x++) {
                var c = this.getCell(new Point(x, y));
                c = this.applyRules(c);
                this.newCells[y].push(c);
            }
        }
    };
    /**
     * Step forward one generation
     */
    Life.prototype.step = function () {
        this.calculateNewCells();
        this.oldCells = this.cells;
        this.cells = this.newCells;
        this.drawAllCells();
    };
    /**
     * Being automatically stepping forward until told to stop, at the saved rate
     */
    Life.prototype.play = function () {
        this.playPauseButton.classList.remove('paused');
        this.playPauseButton.classList.add('playing');
        this.playPauseButton.querySelector('.text').innerHTML = 'Pause';
        this.step();
        this.intervalReference = setInterval(function () {
            this.step();
        }.bind(this), 1000 / this.speed);
    };
    /**
     * Stop stepping forward
     */
    Life.prototype.pause = function () {
        this.playPauseButton.classList.remove('playing');
        this.playPauseButton.classList.add('paused');
        this.playPauseButton.querySelector('.text').innerHTML = 'Play';
        clearInterval(this.intervalReference);
    };
    Life.prototype.reset = function () {
        if (this.isPlaying) {
            this.pause();
        }
        this.clear();
    };
    Life.prototype.clear = function () {
        for (var y = 0; y < this.height; y++) {
            for (var x = 0; x < this.width; x++) {
                var c = this.getCell(new Point(x, y));
                c.kill();
            }
        }
        this.drawAllCells();
    };
    Life.prototype.playPause = function () {
        this.isPlaying ? this.pause() : this.play();
        this.isPlaying = !this.isPlaying;
    };
    return Life;
}());
// @todo Write unit tests
var Point = (function () {
    function Point(x, y) {
        this.x = x;
        this.y = y;
    }
    Point.prototype.log = function () {
        console.log('(' + this.x + ', ' + this.y + ')');
    };
    return Point;
}());
var debug = true;
var C = new Canvas("#the-canvas");
var L = new Life(C);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC90cy9saWIvQ2FudmFzLnRzIiwiYXBwL3RzL2xpYi9DZWxsLnRzIiwiYXBwL3RzL2xpYi9MaWZlLnRzIiwiYXBwL3RzL2xpYi9Qb2ludC50cyIsImFwcC90cy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHlCQUF5QjtBQUN6QjtJQVFJLGdCQUFZLFFBQWdCO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQXVCLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkUsTUFBTSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV4QyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFbkMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsb0NBQW1CLEdBQW5CO1FBQ0ksTUFBTSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxVQUFTLENBQUM7WUFDeEMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDckIsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDL0IsQ0FBQztRQUNMLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQsb0NBQW1CLEdBQW5CO1FBQ0ksSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3pFLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FB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QUM7UUFDTixDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsS0FBSyxDQUFDLElBQUksQ0FDTixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FDNUMsQ0FBQztRQUNOLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDeEMsS0FBSyxDQUFDLElBQUksQ0FDTixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FDNUMsQ0FBQztRQUNOLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN2QixLQUFLLENBQUMsSUFBSSxDQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3hDLENBQUM7UUFDTixDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLEtBQUssQ0FBQyxJQUFJLENBQ04s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R0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFTCxZQUFDO0FBQUQsQ0FkQSxBQWNDLElBQUE7QUNmRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7QUFFakIsSUFBSSxDQUFDLEdBQVcsSUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDMUMsSUFBSSxDQUFDLEdBQVMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0b2RvIFdyaXRlIHVuaXQgdGVzdHNcbmNsYXNzIENhbnZhcyB7XG4gICAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbiAgICB3aWR0aDogbnVtYmVyO1xuICAgIHN0YXRpYyBsYXN0UmVzaXplOiBudW1iZXI7XG5cbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICAgIGNvbnN0cnVjdG9yKHNlbGVjdG9yOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuICAgICAgICBDYW52YXMubGFzdFJlc2l6ZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiSW5pdGlhbGl6aW5nIGNhbnZhc1wiKTtcblxuICAgICAgICB0aGlzLnNldENhbnZhc0RpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5hcHBseVJlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgcmVzaXplIGxpc3RlbmVyIG9uIHRoZSB3aW5kb3cgJiB1cGRhdGUgY2FudmFzIGRpbWVuc2lvbnMgb24gcmVzaXplXG4gICAgICovXG4gICAgYXBwbHlSZXNpemVMaXN0ZW5lcigpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmIChDYW52YXMuY2FuUmVzaXplKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldENhbnZhc0RpbWVuc2lvbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBzZXRDYW52YXNEaW1lbnNpb25zKCkge1xuICAgICAgICBsZXQgY2FudmFzRGltZW5zaW9ucyA9IHRoaXMuY2FudmFzLnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHRoaXMuc2V0V2lkdGgoY2FudmFzRGltZW5zaW9ucy53aWR0aCk7XG4gICAgICAgIHRoaXMuc2V0SGVpZ2h0KGNhbnZhc0RpbWVuc2lvbnMuaGVpZ2h0KTtcbiAgICB9XG5cbiAgICBzZXRXaWR0aCh3OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IHcgLSAodyAlIENlbGwuc2l6ZSk7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIHRoaXMuZ2V0V2lkdGgoKS50b1N0cmluZygpKTtcbiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUud2lkdGggPSB0aGlzLmdldFdpZHRoKCkudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBzZXRIZWlnaHQoaDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaCAtIChoICUgQ2VsbC5zaXplKTtcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsIHRoaXMuZ2V0SGVpZ2h0KCkudG9TdHJpbmcoKSk7XG4gICAgICAgIHRoaXMuY2FudmFzLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCkudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBnZXRIZWlnaHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0O1xuICAgIH1cbiAgICBnZXRXaWR0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy53aWR0aDtcbiAgICB9XG5cbiAgICBnZXRDb250ZXh0KCk6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCB7XG4gICAgICAgIHJldHVybiB0aGlzLmN0eDtcbiAgICB9XG5cbiAgICBnZXRDYW52YXMoKTogSFRNTENhbnZhc0VsZW1lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXM7XG4gICAgfVxuXG4gICAgc3RhdGljIGNhblJlc2l6ZSgpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IG5vdzogbnVtYmVyID0gRGF0ZS5ub3coKTtcbiAgICAgICAgcmV0dXJuIG5vdyAtIDEwMDAgPj0gQ2FudmFzLmxhc3RSZXNpemU7XG4gICAgfVxuXG59IiwiLy8gQHRvZG8gV3JpdGUgdW5pdCB0ZXN0c1xuY2xhc3MgQ2VsbCB7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcblxuICAgIGFsaXZlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBzdGF0aWMgc2l6ZTogbnVtYmVyID0gMjAwO1xuXG4gICAgLy8gQHRvZG8gdGhpcyBzaG91bGQgcHJvYmFibHkgdXNlIGEgUG9pbnRcbiAgICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuXG4gICAgfVxuXG4gICAgdG9nZ2xlKCkge1xuICAgICAgICB0aGlzLmFsaXZlID0gIXRoaXMuYWxpdmU7XG4gICAgfVxuXG4gICAga2lsbCgpIHtcbiAgICAgICAgdGhpcy5hbGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJlZ2VuKCkge1xuICAgICAgICB0aGlzLmFsaXZlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpc0FsaXZlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hbGl2ZTtcbiAgICB9XG5cbiAgICBnZXRYKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBDZWxsLmdldEFjdHVhbFBvc2l0aW9uKHRoaXMueCk7XG4gICAgfVxuXG4gICAgZ2V0WSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gQ2VsbC5nZXRBY3R1YWxQb3NpdGlvbih0aGlzLnkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGFjdHVhbCBwb3NpdGlvbiAoeCBvciB5KSBiYXNlZCBvbiB0aGUgY2VsbCBzaXplXG4gICAgICovXG4gICAgc3RhdGljIGdldEFjdHVhbFBvc2l0aW9uKGk6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiAoaSAqIENlbGwuc2l6ZSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFNpemUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIENlbGwuc2l6ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgc2V0U2l6ZSh4OiBudW1iZXIpIHtcbiAgICAgICAgQ2VsbC5zaXplID0geDtcbiAgICB9XG5cbiAgICBjb250YWlucyh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgeCA+PSB0aGlzLnggJiZcbiAgICAgICAgICAgIHggPD0gQ2VsbC5nZXRBY3R1YWxQb3NpdGlvbih0aGlzLngpICYmXG4gICAgICAgICAgICB5ID49IHRoaXMueSAmJlxuICAgICAgICAgICAgeSA8PSBDZWxsLmdldEFjdHVhbFBvc2l0aW9uKHRoaXMueSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUYWtlIHRoZSBtb3VzZSBvZmZzZXQgaW4gdGhlIGNhbnZhcyBlbGVtZW50LCBtb2QgQ2VsbCBzaXplLCB0YWtlIHRoYXQgYW1vdW50IGFuZCB0cmltIGl0XG4gICAgICogZnJvbSB0aGUgbW91c2Ugb2Zmc2V0LiBEaXZpZGUgYnkgY2VsbCBzaXplLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRDZWxsQ29vcmRpbmF0ZXMocDogUG9pbnQpOiBQb2ludCB7XG4gICAgICAgIGxldCB4ID0gTWF0aC5mbG9vcigocC54IC0gKHAueCAlIENlbGwuc2l6ZSkpIC8gKENlbGwuc2l6ZSkpLFxuICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoKHAueSAtIChwLnkgJSBDZWxsLnNpemUpKSAvIChDZWxsLnNpemUpKTtcblxuICAgICAgICByZXR1cm4gbmV3IFBvaW50KHgsIHkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBQb2ludCBvZiBDZWxsXG4gICAgICovXG4gICAgZ2V0UG9pbnQoKTogUG9pbnQge1xuICAgICAgICByZXR1cm4gbmV3IFBvaW50KHRoaXMueCwgdGhpcy55KTtcbiAgICB9XG5cbn0iLCIvLyBAdG9kbyBXcml0ZSB1bml0IHRlc3RzXG5jbGFzcyBMaWZlIHtcblxuICAgIGNlbGxzOiBDZWxsW11bXSA9IG51bGw7XG4gICAgb2xkQ2VsbHM6IENlbGxbXVtdID0gbnVsbDtcbiAgICBuZXdDZWxsczogQ2VsbFtdW10gPSBudWxsO1xuXG4gICAgY2FudmFzOiBDYW52YXM7XG5cbiAgICBwbGF5UGF1c2VCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHN0ZXBCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHJlc2V0QnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICBzcGVlZFJhbmdlOiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHNpemVSYW5nZTogSFRNTElucHV0RWxlbWVudDtcblxuICAgIGlzUGxheWluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgaGVpZ2h0OiBudW1iZXIgPSA0MDA7XG4gICAgd2lkdGg6IG51bWJlciA9IDYwMDtcblxuICAgIHNwZWVkOiBudW1iZXIgPSAxO1xuICAgIHNpemU6IG51bWJlciA9IDE7XG5cbiAgICBwcml2YXRlIGludGVydmFsUmVmZXJlbmNlOiBudW1iZXI7XG5cblxuICAgIGNvbnN0cnVjdG9yKGM6IENhbnZhcykge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGM7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldENhbnZhc0RpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5hc3NpZ25Ub29sYmFyRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVDZWxscygpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZU5ld0NlbGxzKCk7XG4gICAgICAgIHRoaXMuZHJhd0FsbENlbGxzKCk7XG5cbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBhZGRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLmdldENhbnZhcygpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrLmJpbmQodGhpcykpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLnBsYXlQYXVzZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zdGVwQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5zdGVwLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnJlc2V0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5yZXNldC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zcGVlZFJhbmdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25DaGFuZ2VTcGVlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zaXplUmFuZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5vbkNoYW5nZVNpemUuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgYXNzaWduVG9vbGJhckVsZW1lbnRzKCkge1xuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXktcGF1c2UtYnV0dG9uJyk7XG4gICAgICAgIHRoaXMuc3RlcEJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0ZXAtYnV0dG9uJyk7XG4gICAgICAgIHRoaXMucmVzZXRCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXNldC1idXR0b24nKTtcbiAgICAgICAgdGhpcy5zcGVlZFJhbmdlID0gPEhUTUxJbnB1dEVsZW1lbnQ+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcGVlZC1yYW5nZScpO1xuICAgICAgICB0aGlzLnNpemVSYW5nZSA9IDxIVE1MSW5wdXRFbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2l6ZS1yYW5nZScpO1xuICAgIH1cblxuICAgIG9uQ2xpY2soZTogTW91c2VFdmVudCkge1xuICAgICAgICBsZXQgbW91c2VDbGlja1BvaW50ID0gbmV3IFBvaW50KGUub2Zmc2V0WCwgZS5vZmZzZXRZKTtcbiAgICAgICAgbGV0IGNlbGxDb29yZGluYXRlcyA9IENlbGwuZ2V0Q2VsbENvb3JkaW5hdGVzKG1vdXNlQ2xpY2tQb2ludCk7XG5cbiAgICAgICAgLy8gdG9nZ2xlIHRoYXQgY2VsbFxuICAgICAgICBsZXQgYyA9IHRoaXMuZ2V0Q2VsbChjZWxsQ29vcmRpbmF0ZXMpO1xuICAgICAgICBjLnRvZ2dsZSgpO1xuICAgICAgICB0aGlzLmRyYXdDZWxsKGMpO1xuICAgIH1cblxuICAgIG9uUmVzaXplKCkge1xuICAgICAgICBpZiAoQ2FudmFzLmNhblJlc2l6ZSgpKVxuICAgICAgICAgICAgdGhpcy5kcmF3QWxsQ2VsbHMoKTtcbiAgICB9XG5cbiAgICBvbkNoYW5nZVNwZWVkKCkge1xuICAgICAgICBsZXQgd2FzUGxheWluZyA9IHRoaXMuaXNQbGF5aW5nO1xuICAgICAgICBpZiAodGhpcy5pc1BsYXlpbmcpXG4gICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgIHRoaXMuc3BlZWQgPSB0aGlzLnNwZWVkUmFuZ2UudmFsdWVBc051bWJlcjtcbiAgICAgICAgaWYgKHdhc1BsYXlpbmcpXG4gICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICB9XG5cbiAgICBvbkNoYW5nZVNpemUoKSB7XG4gICAgICAgIENlbGwuc2V0U2l6ZSgxMDAgLyB0aGlzLnNpemVSYW5nZS52YWx1ZUFzTnVtYmVyKTtcbiAgICAgICAgdGhpcy5jcmVhdGVDZWxscygpO1xuICAgICAgICB0aGlzLmRyYXdBbGxDZWxscygpO1xuICAgIH1cblxuICAgIGNyZWF0ZUNlbGxzKCkge1xuICAgICAgICB0aGlzLmNlbGxzID0gW107XG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5oZWlnaHQ7IHkrKykge1xuICAgICAgICAgICAgdGhpcy5jZWxscy5wdXNoKFtdKTtcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGM6IENlbGwgPSBuZXcgQ2VsbCh4LCB5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNlbGxzW3ldLnB1c2goYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEcmF3IGEgZ2l2ZW4gY2VsbCBvbiB0aGUgY2FudmFzXG4gICAgICovXG4gICAgZHJhd0NlbGwoYzogQ2VsbCkge1xuICAgICAgICBpZiAodGhpcy5jZWxsT2ZmU2NyZWVuKGMpKSB7XG4gICAgICAgICAgICBjLmtpbGwoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJibGFja1wiO1xuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgICAgIGN0eC5maWxsUmVjdChjLmdldFgoKSwgYy5nZXRZKCksIENlbGwuZ2V0U2l6ZSgpLCBDZWxsLmdldFNpemUoKSk7XG4gICAgICAgIGlmICghYy5hbGl2ZSkge1xuICAgICAgICAgICAgLy8gSGFkIHNvbWUgd2VpcmQgaXNzdWVzIHdpdGggdXNpbmcgY3R4LnN0cm9rZVJlY3QsXG4gICAgICAgICAgICAvLyBzZWVtZWQgdG8gY3JlYXRlIGEgbGFyZ2VyIHJlY3RhbmdsZSB0aGFuIGp1c3QgY3R4LmZpbGxSZWN0XG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KGMuZ2V0WCgpICsgMSwgYy5nZXRZKCkgKyAxLCBDZWxsLmdldFNpemUoKSAtIDIsIENlbGwuZ2V0U2l6ZSgpIC0gMik7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdvIHRocm91Z2ggbWF0cml4IGFuZCBjYWxsIHRoaXMuZHJhd0NlbGwgb24gYWxsIGNlbGxzXG4gICAgICovXG4gICAgZHJhd0FsbENlbGxzKCkge1xuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMud2lkdGg7IHgrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3Q2VsbCh0aGlzLmdldENlbGwobmV3IFBvaW50KHgsIHkpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSBzcGVjaWZpYyBjZWxsIGZyb20gdGhlIG1hdHJpeCwgZ2l2ZW4gYSBwb2ludFxuICAgICAqL1xuICAgIGdldENlbGwocDogUG9pbnQpOiBDZWxsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2VsbHNbcC55XVtwLnhdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBjZWxsIGlzIG9mZiBzY3JlZW5cbiAgICAgKi9cbiAgICBjZWxsT2ZmU2NyZWVuKGMpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGMuZ2V0WCgpICsgQ2VsbC5nZXRTaXplKCkgPiB0aGlzLmNhbnZhcy5nZXRXaWR0aCgpIHx8IGMuZ2V0WSgpICsgQ2VsbC5nZXRTaXplKCkgPiB0aGlzLmNhbnZhcy5nZXRIZWlnaHQoKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBtYXRyaXggb2YgYWxsIHN1cnJvdW5kaW5nL2FkamFjZW50IGNlbGxzXG4gICAgICovXG4gICAgZ2V0U3Vycm91bmRpbmdDZWxscyhjOiBDZWxsKTogQ2VsbFtdIHtcbiAgICAgICAgbGV0IGNlbGxzID0gW107XG5cbiAgICAgICAgLy8gQHRvZG8gRmlndXJlIG91dCBhIG1vcmUgZWxlZ2FudCB3YXkgdG8gZG8gdGhpcz9cbiAgICAgICAgaWYgKGMueCAtIDEgPj0gMCkge1xuICAgICAgICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLmdldENlbGwobmV3IFBvaW50KGMueCAtIDEsIGMueSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjLnggLSAxID49IDAgJiYgYy55IC0gMSA+PSAwKSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54IC0gMSwgYy55IC0gMSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjLnggLSAxID49IDAgJiYgYy55ICsgMSA8IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54IC0gMSwgYy55ICsgMSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjLnggKyAxIDwgdGhpcy53aWR0aCkge1xuICAgICAgICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLmdldENlbGwobmV3IFBvaW50KGMueCArIDEsIGMueSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjLnkgLSAxID49IDAgJiYgYy54ICsgMSA8IHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgIGNlbGxzLnB1c2goXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDZWxsKG5ldyBQb2ludChjLnggKyAxLCBjLnkgLSAxKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueCArIDEgPCB0aGlzLndpZHRoICYmIGMueSArIDEgPCB0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLmdldENlbGwobmV3IFBvaW50KGMueCArIDEsIGMueSArIDEpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYy55ICsgMSA8IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBjZWxscy5wdXNoKFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2VsbChuZXcgUG9pbnQoYy54LCBjLnkgKyAxKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMueSAtIDEgPj0gMCkge1xuICAgICAgICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgICAgICAgICB0aGlzLmdldENlbGwobmV3IFBvaW50KGMueCwgYy55IC0gMSkpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNlbGxzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBjZWxsIHNob3VsZCBkaWUgb2ZmLiBSdWxlIGFwcGxpZWQgZGlyZWN0bHkgdG8gY2VsbC5cbiAgICAgKi9cbiAgICBzaG91bGRDZWxsRGllUnVsZShjOiBDZWxsKSB7XG4gICAgICAgIGxldCBjZWxscyA9IHRoaXMuZ2V0U3Vycm91bmRpbmdDZWxscyhjKTtcbiAgICAgICAgbGV0IGFsaXZlQ2VsbHMgPSBjZWxscy5maWx0ZXIoZnVuY3Rpb24gKGNlbGwsIGluZGV4LCBhcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuIGNlbGwuaXNBbGl2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGMuaXNBbGl2ZSgpICYmIChhbGl2ZUNlbGxzLmxlbmd0aCA+IDMgfHwgYWxpdmVDZWxscy5sZW5ndGggPCAyKSlcbiAgICAgICAgICAgIGMua2lsbCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBjZWxsIHNob3VsZCBiZSBicm91Z2h0IGJhY2sgdG8gbGlmZS4gUnVsZSBhcHBsaWVkIGRpcmVjdGx5IHRvIGNlbGwuXG4gICAgICovXG4gICAgc2hvdWxkQ2VsbFJlZ2VuZXJhdGVSdWxlKGM6IENlbGwpIHtcbiAgICAgICAgbGV0IGNlbGxzID0gdGhpcy5nZXRTdXJyb3VuZGluZ0NlbGxzKGMpO1xuICAgICAgICBsZXQgYWxpdmVDZWxscyA9IGNlbGxzLmZpbHRlcihmdW5jdGlvbiAoY2VsbCwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5pc0FsaXZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWMuaXNBbGl2ZSgpICYmIChhbGl2ZUNlbGxzLmxlbmd0aCA9PSAzKSkge1xuICAgICAgICAgICAgYy5yZWdlbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXBwbHlSdWxlcyhjOiBDZWxsKTogQ2VsbCB7XG4gICAgICAgIGxldCBuZXdDZWxsID0gTGlmZS5jbG9uZUNlbGwoYyk7XG4gICAgICAgIGlmIChjLmlzQWxpdmUoKSkge1xuICAgICAgICAgICAgdGhpcy5zaG91bGRDZWxsRGllUnVsZShuZXdDZWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2hvdWxkQ2VsbFJlZ2VuZXJhdGVSdWxlKG5ld0NlbGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld0NlbGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFrZSBhIGNsb25lIG9mIGEgY2VsbFxuICAgICAqL1xuICAgIHN0YXRpYyBjbG9uZUNlbGwoYzogQ2VsbCk6IENlbGwge1xuICAgICAgICBsZXQgbmV3Q2VsbCA9IG5ldyBDZWxsKGMueCwgYy55KTtcbiAgICAgICAgYy5pc0FsaXZlKCkgPyBuZXdDZWxsLnJlZ2VuKCkgOiBuZXdDZWxsLmtpbGwoKTtcbiAgICAgICAgcmV0dXJuIG5ld0NlbGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIG1hdHJpeCBvZiBjZWxscyBmb3IgdGhlIG5leHQgc3RlcCwgYmFzZWQgb24gYXBwbGllZCBydWxlc1xuICAgICAqL1xuICAgIGNhbGN1bGF0ZU5ld0NlbGxzKCkge1xuICAgICAgICB0aGlzLm5ld0NlbGxzID0gW107XG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5oZWlnaHQ7IHkrKykge1xuICAgICAgICAgICAgdGhpcy5uZXdDZWxscy5wdXNoKFtdKTtcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGMgPSB0aGlzLmdldENlbGwobmV3IFBvaW50KHgsIHkpKTtcbiAgICAgICAgICAgICAgICBjID0gdGhpcy5hcHBseVJ1bGVzKGMpO1xuICAgICAgICAgICAgICAgIHRoaXMubmV3Q2VsbHNbeV0ucHVzaChjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0ZXAgZm9yd2FyZCBvbmUgZ2VuZXJhdGlvblxuICAgICAqL1xuICAgIHN0ZXAoKSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlTmV3Q2VsbHMoKTtcbiAgICAgICAgdGhpcy5vbGRDZWxscyA9IHRoaXMuY2VsbHM7XG4gICAgICAgIHRoaXMuY2VsbHMgPSB0aGlzLm5ld0NlbGxzO1xuICAgICAgICB0aGlzLmRyYXdBbGxDZWxscygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlaW5nIGF1dG9tYXRpY2FsbHkgc3RlcHBpbmcgZm9yd2FyZCB1bnRpbCB0b2xkIHRvIHN0b3AsIGF0IHRoZSBzYXZlZCByYXRlXG4gICAgICovXG4gICAgcGxheSgpIHtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgncGF1c2VkJylcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uY2xhc3NMaXN0LmFkZCgncGxheWluZycpO1xuICAgICAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbi5xdWVyeVNlbGVjdG9yKCcudGV4dCcpLmlubmVySFRNTCA9ICdQYXVzZSc7XG4gICAgICAgIHRoaXMuc3RlcCgpO1xuICAgICAgICB0aGlzLmludGVydmFsUmVmZXJlbmNlID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zdGVwKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSwgMTAwMCAvIHRoaXMuc3BlZWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0b3Agc3RlcHBpbmcgZm9yd2FyZFxuICAgICAqL1xuICAgIHBhdXNlKCkge1xuXG4gICAgICAgIHRoaXMucGxheVBhdXNlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ3BsYXlpbmcnKTtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uY2xhc3NMaXN0LmFkZCgncGF1c2VkJyk7XG4gICAgICAgIHRoaXMucGxheVBhdXNlQnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJy50ZXh0JykuaW5uZXJIVE1MID0gJ1BsYXknO1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxSZWZlcmVuY2UpO1xuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICBpZiAodGhpcy5pc1BsYXlpbmcpIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsZWFyKCk7XG5cbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMud2lkdGg7IHgrKykge1xuICAgICAgICAgICAgICAgIGxldCBjID0gdGhpcy5nZXRDZWxsKG5ldyBQb2ludCh4LCB5KSk7XG4gICAgICAgICAgICAgICAgYy5raWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kcmF3QWxsQ2VsbHMoKTtcbiAgICB9XG5cbiAgICBwbGF5UGF1c2UoKSB7XG4gICAgICAgIHRoaXMuaXNQbGF5aW5nID8gdGhpcy5wYXVzZSgpIDogdGhpcy5wbGF5KCk7XG4gICAgICAgIHRoaXMuaXNQbGF5aW5nID0gIXRoaXMuaXNQbGF5aW5nO1xuICAgIH1cblxufSIsIi8vIEB0b2RvIFdyaXRlIHVuaXQgdGVzdHNcbmNsYXNzIFBvaW50IHtcblxuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuICAgIH1cblxuICAgIGxvZygpIHtcbiAgICAgICAgY29uc29sZS5sb2coJygnICsgdGhpcy54ICsgJywgJyArIHRoaXMueSArICcpJyk7XG4gICAgfVxuXG59IiwidmFyIGRlYnVnID0gdHJ1ZTtcblxubGV0IEM6IENhbnZhcyA9IG5ldyBDYW52YXMoXCIjdGhlLWNhbnZhc1wiKTtcbmxldCBMOiBMaWZlID0gbmV3IExpZmUoQyk7Il19
